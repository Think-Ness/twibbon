<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Twibbon Maker â€” Modern</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-white min-h-screen flex justify-center items-center font-sans">
  <div class="bg-white shadow-2xl rounded-2xl p-8 w-full max-w-4xl">
    <div class="flex items-center justify-center mb-6 gap-3">
      <img id="logo" src="assets/logo.png" alt="Logo" class="w-10 h-10 object-contain" />
      <h1 class="text-2xl font-bold text-gray-800">Twibbon Vocal Group Amoung Hostel</h1>
    </div>

    <p class="text-center text-gray-600 mb-6">Upload foto dari kamera atau file, pilih twibbon dari folder <code>assets/</code>, tentukan rasio atau ukuran, lalu klik <b>Generate</b> untuk hasil akhir.</p>

    <div class="flex flex-wrap justify-center gap-3 mb-5">
      <label class="cursor-pointer bg-gray-100 border px-4 py-2 rounded-lg hover:bg-blue-50">
        <input id="imgInput" type="file" accept="image/*" capture="environment" class="hidden"> Upload / Kamera
      </label>
      <select id="overlaySelect" class="border rounded-lg px-4 py-2 text-gray-700">
        <option value="">-- Pilih twibbon dari assets --</option>
        <option value="assets/twibbon1.png">Twibbon 1</option>
        <option value="assets/twibbon2.png">Twibbon 2</option>
        <option value="assets/twibbon3.png">Twibbon 3</option>
      </select>
      <select id="ratioSelect" class="border rounded-lg px-4 py-2 text-gray-700">
        <option value="1">Rasio 1:1 (Kotak)</option>
        <option value="4/3">Rasio 4:3</option>
        <option value="3/4">Rasio 3:4</option>
        <option value="16/9">Rasio 16:9</option>
        <option value="9/16">Rasio 9:16</option>
      </select>
      <input id="customSize" type="number" placeholder="Ukuran (px)" min="400" max="2000" class="border rounded-lg px-4 py-2 w-32" />
      <button id="generate" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Generate & Download</button>
      <button id="reset" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition">Reset</button>
    </div>

    <div>
      <label class="block text-gray-600 mb-2 text-sm">Preview (klik & seret untuk geser, scroll/pinch untuk zoom):</label>
      <canvas id="canvas" width="1200" height="1200" class="w-full bg-gray-900 rounded-xl"></canvas>
    </div>
  </div>

  <script>
  const canvas=document.getElementById('canvas');
  const ctx=canvas.getContext('2d');
  let userImg=null,overlayImg=null;
  let offset={x:0,y:0},scale=1,dragging=false,last={x:0,y:0};
  const imgInput=document.getElementById('imgInput');
  const overlaySelect=document.getElementById('overlaySelect');
  const ratioSelect=document.getElementById('ratioSelect');
  const customSize=document.getElementById('customSize');
  const generateBtn=document.getElementById('generate');
  const resetBtn=document.getElementById('reset');

  function clearCanvas(){ctx.fillStyle='#222';ctx.fillRect(0,0,canvas.width,canvas.height);}
  function redraw(){
    clearCanvas();
    if(userImg){
      const cw=canvas.width,ch=canvas.height,iw=userImg.width,ih=userImg.height;
      const r=Math.max(cw/iw,ch/ih);
      const drawW=iw*r*scale,drawH=ih*r*scale;
      const dx=(cw-drawW)/2+offset.x,dy=(ch-drawH)/2+offset.y;
      ctx.drawImage(userImg,dx,dy,drawW,drawH);
    }
    if(overlayImg){ctx.drawImage(overlayImg,0,0,canvas.width,canvas.height);}
  }

  function setCanvasRatio(){
    const ratio=eval(ratioSelect.value);
    const size=parseInt(customSize.value)||1200;
    canvas.width=size;
    canvas.height=size/ratio;
    redraw();
  }

  ratioSelect.addEventListener('change',setCanvasRatio);
  customSize.addEventListener('change',setCanvasRatio);

  imgInput.addEventListener('change',e=>{
    const f=e.target.files?.[0];if(!f)return;
    const url=URL.createObjectURL(f);
    const img=new Image();
    img.onload=()=>{userImg=img;offset={x:0,y:0};scale=1;redraw();URL.revokeObjectURL(url);};
    img.src=url;
  });

  overlaySelect.addEventListener('change',()=>{
    const val=overlaySelect.value;if(!val){overlayImg=null;redraw();return;}
    const img=new Image();img.onload=()=>{overlayImg=img;redraw();};img.src=val;
  });

  canvas.addEventListener('pointerdown',ev=>{dragging=true;last={x:ev.clientX,y:ev.clientY};canvas.setPointerCapture(ev.pointerId);});
  canvas.addEventListener('pointermove',ev=>{if(!dragging)return;const dx=ev.clientX-last.x,dy=ev.clientY-last.y;last={x:ev.clientX,y:ev.clientY};offset.x+=dx;offset.y+=dy;redraw();});
  canvas.addEventListener('pointerup',ev=>{dragging=false;canvas.releasePointerCapture(ev.pointerId);});
  canvas.addEventListener('wheel',ev=>{ev.preventDefault();const f=ev.deltaY<0?1.05:0.95;scale*=f;scale=Math.max(0.3,Math.min(4,scale));redraw();});

  generateBtn.addEventListener('click',()=>{
    if(!userImg){alert('Upload foto dulu ya!');return;}
    const data=canvas.toDataURL('image/png');
    const a=document.createElement('a');a.href=data;a.download='twibbon-result.png';a.click();
  });

  resetBtn.addEventListener('click',()=>{userImg=null;overlayImg=null;offset={x:0,y:0};scale=1;imgInput.value='';overlaySelect.value='';customSize.value='';ratioSelect.value='1';setCanvasRatio();});

  setCanvasRatio();
  clearCanvas();
  </script>
</body>
</html>