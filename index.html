<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Twibbon Maker — Vocal Group Amoung Hostel</title>
  <style>
    body{font-family:'Inter',system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,#ece9e6,#ffffff);margin:0;padding:0;display:flex;justify-content:center;align-items:center;min-height:100vh}
    .card{background:#fff;border-radius:20px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.08);max-width:960px;width:95%;}
    h1{text-align:center;margin-bottom:10px;font-size:24px;color:#333;}
    .controls{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:16px}
    button,input[type=file],select{padding:10px 14px;border-radius:10px;border:1px solid #ddd;background:#f9f9f9;font-size:14px;cursor:pointer;transition:all .2s}
    button:hover,input[type=file]:hover,select:hover{background:#eef;}
    button.primary{background:#2563eb;color:#fff;border:none;}
    button.primary:hover{background:#1e40af;}
    canvas{width:100%;height:auto;border-radius:12px;display:block;background:#111;margin-top:10px}
    .hint{font-size:14px;color:#555;margin-bottom:16px;text-align:center;}
    .row{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start;}
    .col{flex:1;min-width:260px;}
    .label{font-size:13px;color:#666;margin-bottom:4px;display:block;}
  </style>
</head>
<body>
  <div class="card">
    <h1>✨ Twibbon Maker Modern ✨</h1>
    <div class="hint">Upload foto dari kamera atau file, pilih twibbon dari folder <code>assets/</code>, tentukan rasio atau ukuran, lalu klik "Generate" untuk hasil akhir.</div>

    <div class="controls">
      <label><input id="imgInput" type="file" accept="image/*" capture="environment"> Upload / Kamera</label>
      <select id="overlaySelect">
        <option value="">-- Pilih twibbon dari assets --</option>
        <option value="assets/twibbon1.png">Twibbon 1</option>
        <option value="assets/twibbon2.png">Twibbon 2</option>
        <option value="assets/twibbon3.png">Twibbon 3</option>
      </select>
      <select id="ratioSelect">
        <option value="1">Rasio 1:1 (Kotak)</option>
        <option value="4/3">Rasio 4:3</option>
        <option value="3/4">Rasio 3:4</option>
        <option value="16/9">Rasio 16:9</option>
        <option value="9/16">Rasio 9:16</option>
      </select>
      <input id="customSize" type="number" placeholder="Ukuran (px)" min="400" max="2000" style="width:120px;">
      <button class="primary" id="generate">Generate & Download</button>
      <button id="reset">Reset</button>
    </div>

    <div class="row">
      <div class="col">
        <label class="label">Preview (klik & seret untuk geser, scroll/pinch untuk zoom):</label>
        <canvas id="canvas" width="1200" height="1200"></canvas>
      </div>
    </div>
  </div>

<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let userImg=null,overlayImg=null;
let offset={x:0,y:0},scale=1,dragging=false,last={x:0,y:0};
const imgInput=document.getElementById('imgInput');
const overlaySelect=document.getElementById('overlaySelect');
const ratioSelect=document.getElementById('ratioSelect');
const customSize=document.getElementById('customSize');
const generateBtn=document.getElementById('generate');
const resetBtn=document.getElementById('reset');

function clearCanvas(){ctx.fillStyle='#222';ctx.fillRect(0,0,canvas.width,canvas.height);}
function redraw(){
  clearCanvas();
  if(userImg){
    const cw=canvas.width,ch=canvas.height,iw=userImg.width,ih=userImg.height;
    const r=Math.max(cw/iw,ch/ih);
    const drawW=iw*r*scale,drawH=ih*r*scale;
    const dx=(cw-drawW)/2+offset.x,dy=(ch-drawH)/2+offset.y;
    ctx.drawImage(userImg,dx,dy,drawW,drawH);
  }
  if(overlayImg){ctx.drawImage(overlayImg,0,0,canvas.width,canvas.height);}
}

function setCanvasRatio(){
  const ratio=eval(ratioSelect.value);
  const size=parseInt(customSize.value)||1200;
  canvas.width=size;
  canvas.height=size/ratio;
  redraw();
}

ratioSelect.addEventListener('change',setCanvasRatio);
customSize.addEventListener('change',setCanvasRatio);

imgInput.addEventListener('change',e=>{
  const f=e.target.files?.[0];if(!f)return;
  const url=URL.createObjectURL(f);
  const img=new Image();
  img.onload=()=>{userImg=img;offset={x:0,y:0};scale=1;redraw();URL.revokeObjectURL(url);};
  img.src=url;
});

overlaySelect.addEventListener('change',()=>{
  const val=overlaySelect.value;if(!val){overlayImg=null;redraw();return;}
  const img=new Image();img.onload=()=>{overlayImg=img;redraw();};img.src=val;
});

canvas.addEventListener('pointerdown',ev=>{dragging=true;last={x:ev.clientX,y:ev.clientY};canvas.setPointerCapture(ev.pointerId);});
canvas.addEventListener('pointermove',ev=>{if(!dragging)return;const dx=ev.clientX-last.x,dy=ev.clientY-last.y;last={x:ev.clientX,y:ev.clientY};offset.x+=dx;offset.y+=dy;redraw();});
canvas.addEventListener('pointerup',ev=>{dragging=false;canvas.releasePointerCapture(ev.pointerId);});
canvas.addEventListener('wheel',ev=>{ev.preventDefault();const f=ev.deltaY<0?1.05:0.95;scale*=f;scale=Math.max(0.3,Math.min(4,scale));redraw();});

generateBtn.addEventListener('click',()=>{
  if(!userImg){alert('Upload foto dulu ya!');return;}
  const data=canvas.toDataURL('image/png');
  const a=document.createElement('a');a.href=data;a.download='twibbon-result.png';a.click();
});

resetBtn.addEventListener('click',()=>{userImg=null;overlayImg=null;offset={x:0,y:0};scale=1;imgInput.value='';overlaySelect.value='';customSize.value='';ratioSelect.value='1';setCanvasRatio();});

setCanvasRatio();
clearCanvas();
</script>
</body>
</html>